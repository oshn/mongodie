{"version":3,"sources":["../src/mongodie.js"],"names":["Die","require","MongoDie","init","cursor","loadKey","prop","toTable","arr","id","e","Table","mapKV","Map","Set","table","map","toArray","then","module","exports"],"mappings":"AAAA,IAAIA,MAAMC,QAAQ,WAAR,CAAV;;AAEA,MAAMC,QAAN,SAAuBF,GAAvB,CAA2B;AACvB;;;;;;;AAOAG,SAAMC,MAAN,EAAcC,OAAd,EAAuBC,OAAK,KAA5B,EAAmC;AAC/B,YAAIC,UAAUC,OAAO;AACb,gBAAIC,KAAKC,KAAKJ,OAAOI,EAAEJ,IAAF,CAAP,GAAiBI,CAA/B;;AAEA,gBAAI,CAACC,KAAD,EAAQC,KAAR,IAAiBP,UACX,CAAEQ,GAAF,EAAOH,KAAK,CAACD,GAAGC,CAAH,CAAD,EAAQA,EAAEL,OAAF,CAAR,CAAZ,CADW,GAEX,CAAES,GAAF,EAAOJ,KAAKD,GAAGC,CAAH,CAAZ,CAFV;;AAIA,gBAAIK,QAAQ,IAAIJ,KAAJ,CAAUH,IAAIQ,GAAJ,CAAQJ,KAAR,CAAV,CAAZ;;AAEA,mBAAO,MAAMT,IAAN,CAAWY,KAAX,CAAP;AACH,SAVL;;AAYA,eAAOX,OAAOa,OAAP,GACFC,IADE,CACGX,OADH,CAAP;AAEH;AAvBsB;;AA0B3BY,OAAOC,OAAP,GAAiBlB,QAAjB","file":"mongodie.js","sourcesContent":["let Die = require('spb25-die');\n\nclass MongoDie extends Die {\n    /**\n     * Init\n     * @param  {Mongo.Cursor} cursor\n     * @param  {String} [loadProp]\n     * @param  {String} [prop=_id]\n     * @return {Promise}\n     */\n    init (cursor, loadKey, prop='_id') {\n        let toTable = arr => {\n                let id = e => prop ? e[prop] : e;\n\n                let [Table, mapKV] = loadKey\n                        ? [ Map, e => [id(e), e[loadKey]] ]\n                        : [ Set, e => id(e) ];\n\n                let table = new Table(arr.map(mapKV));\n\n                return super.init(table);\n            };\n\n        return cursor.toArray()\n            .then(toTable);\n    }\n}\n\nmodule.exports = MongoDie;\n"]}